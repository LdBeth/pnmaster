 r←optimal img;bmp;bin;rgb
 ;c;b;euclid;most
 ;m;⎕IO
 ⍝ compute optimal palette
 ⍝ it is recomended using
 ⍝ a shrinked image
 ⎕IO←0
 r←⍬
 euclid←{∧/12996≤+⌿×⍨r(-⍤1 0⍤¯1)⍥((3⍴256)∘⊤)⍵}
 most←(((⊢⍳⌈/)⊢/)⌷⊣/){⍺(+/⍵)}⌸
 ⍝ 16*3 binning map
 bmp←16⊥⌊img÷16
 rgb←,256⊥img
vote:
 ⍝ count bins
 b←(,bmp)most euclid rgb
 c←rgb[⊃⍒,(⊢×{+/,⍵}⌺21 21)bmp=b]
 →(c∊r)/fin
 r,←c
 →vote
fin:
 r←(3 1,≢r)⍴(3⍴256)⊤r
